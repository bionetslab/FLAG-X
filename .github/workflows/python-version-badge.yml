name: Update Python Version Badge

on:
  push:
    paths:
      - "pyproject.toml"
  workflow_dispatch:

jobs:
  generate-badge:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v4

    - name: Extract python version from pyproject.toml
      id: pyvers
      run: |
        PY_VERSION=$(grep -E 'requires-python' pyproject.toml | sed 's/.*= *"//;s/"//')
        echo "version=$PY_VERSION" >> $GITHUB_OUTPUT

    - name: Generate badge
      run: |
        VERSION="${{ steps.pyvers.outputs.version }}"
        COLOR="blue"
        mkdir -p badges
        echo "<svg xmlns='http://www.w3.org/2000/svg' width='200' height='20'>
        <linearGradient id='bg' x1='0' y1='0' x2='0' y2='100%'>
          <stop offset='0' stop-color='#bbb' stop-opacity='.2'/>
          <stop offset='1' stop-opacity='.1'/>
        </linearGradient>
        <rect rx='3' width='200' height='20' fill='#555'/>
        <rect rx='3' x='80' width='120' height='20' fill='$COLOR'/>
        <path fill='$COLOR' d='M80 0h4v20h-4z'/>
        <rect rx='3' width='200' height='20' fill='url(#bg)'/>
        <g fill='#fff' text-anchor='middle'
           font-family='DejaVu Sans,Verdana,Geneva,sans-serif' font-size='11'>
          <text x='40' y='14'>python</text>
          <text x='140' y='14'>$VERSION</text>
        </g>
        </svg>" > badges/python-version.svg

    - name: Commit badge
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: "Update Python version badge"
        file_pattern: "badges/python-version.svg"

